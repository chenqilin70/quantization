<?xml version="1.0" encoding="UTF-8"?>
<sqls>
    <!--
        clrq在2年以上的gp型jj与各主流index的相关系数
    -->
    <corr>
        <![CDATA[
            select
                substring_index(n.rowkey,"_",1) as fundcode,
                substr(i.rowkey,1,instr(i.rowkey,"_")-1) index,
                corr(i.close,n.LJJZ) as correlationindex

            from
                index i
                inner join netval n on substr(i.rowkey,instr(i.rowkey,"_")+1)=substr(n.rowkey,instr(n.rowkey,"_")+1)
                inner join fund f on f.fundcode=substr(n.rowkey,1,instr(n.rowkey,"_")-1)
            where
                i.close is not null
                and n.LJJZ is not null
                and f.jjlx='股票型'
                and f.fxrq is not null
                and add_months(now(),0-(2*12)) >= to_date(regexp_replace(regexp_replace(f.fxrq,'年|月','-'),'日',''))
            group by
                substring_index(n.rowkey,"_",1),
                substr(i.rowkey,1,instr(i.rowkey,"_")-1)
            order by
                fundcode,correlationindex
        ]]>
    </corr>
    <test>
        <![CDATA[
            select
                split(f.yjbjjz,'[+]')
            from
                fund f
        ]]>
    </test>
    <index>
        <![CDATA[
            select * from index
        ]]>
    </index>

</sqls>